<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>QR Codes - Table Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  </head>
  <body class="bg-gray-50 p-8">
    <!-- Hidden data container -->
    <div id="qr-data" style="display: none">
      <span id="tables-data"><%- tablesDataJSON %></span>
      <span id="customer-url"><%= customerSiteUrl %></span>
      <span id="branch-id"><%= branchId %></span>
    </div>

    <div class="max-w-7xl mx-auto" id="qr-container">
      <!-- Header -->
      <h1 class="text-3xl font-bold text-gray-900 mb-8">QR Codes</h1>

      <!-- Rest of your HTML stays the same... -->
      <!-- Area Filter Tabs -->
      <div class="flex flex-wrap gap-4 mb-8">
        <button
          onclick="filterArea('all')"
          id="btn-all"
          class="px-6 py-2 rounded-lg font-medium transition-colors bg-orange-200 text-orange-800"
        >
          All Areas
        </button>
        <% areas.forEach(area => { %>
        <button
          onclick="filterArea('<%= area._id %>')"
          id="btn-<%= area._id %>"
          class="px-6 py-2 rounded-lg font-medium transition-colors bg-gray-200 text-gray-600 hover:bg-gray-300"
        >
          <%= area.name %>
        </button>
        <% }); %>
      </div>

      <!-- Tables Container -->
      <div id="tables-container">
        <% if (areas.length === 0) { %>
        <div class="text-center py-12">
          <p class="text-gray-500 text-lg">
            No areas or tables found for this branch.
          </p>
        </div>
        <% } else { %> <% areas.forEach(area => { const activeTables =
        area.tables.filter(table => table.status === 'Active'); %>
        <div class="area-section mb-8" data-area="<%= area._id %>">
          <h2 class="text-xl font-semibold text-gray-700 mb-4">
            <%= area.name %>
            <span class="text-gray-500 font-normal text-base"
              >(<%= activeTables.length %> Table<%= activeTables.length !== 1 ?
              's' : '' %>)</span
            >
          </h2>

          <% if (activeTables.length === 0) { %>
          <div
            class="text-center py-8 bg-white rounded-lg border border-gray-200"
          >
            <p class="text-gray-500">No active tables in this area.</p>
          </div>
          <% } else { %>
          <div
            class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"
          >
            <% activeTables.forEach(table => { %>
            <div
              class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow"
            >
              <!-- Table Header -->
              <div class="flex items-center justify-between mb-4">
                <% let bgClass = ''; let textClass = ''; if
                (table.availabilityStatus === 'Available') { bgClass =
                'bg-green-100'; textClass = 'text-green-800'; } else if
                (table.availabilityStatus === 'Occupied') { bgClass =
                'bg-blue-100'; textClass = 'text-blue-800'; } else if
                (table.availabilityStatus === 'Reserved') { bgClass =
                'bg-red-100'; textClass = 'text-red-800'; } %>

                <div class="px-4 py-2 rounded-lg <%= bgClass %>">
                  <span class="font-semibold text-lg <%= textClass %>">
                    <%= table.tableCode %>
                  </span>
                </div>

                <div class="text-sm text-gray-600">
                  <%= table.seatingCapacity %> Seat(s)
                </div>
              </div>

              <!-- QR Code -->
              <div class="flex justify-center mb-4 bg-white p-4 rounded-lg">
                <div id="qr-<%= table._id %>" class="qr-code"></div>
              </div>

              <!-- Action Buttons -->
              <div class="flex gap-2">
                <button
                  onclick="downloadQR('<%= table._id %>', '<%= table.tableCode %>')"
                  class="flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors flex items-center justify-center gap-2"
                >
                  <svg
                    class="w-4 h-4"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"
                    />
                  </svg>
                  <span class="hidden sm:inline">Download</span>
                </button>
                <button
                  onclick="openCustomerSite('<%= table._id %>', '<%= table.tableCode %>')"
                  class="flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors flex items-center justify-center gap-2"
                >
                  <svg
                    class="w-4 h-4"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"
                    />
                  </svg>
                  <span class="hidden sm:inline">Open</span>
                </button>
              </div>

              <!-- Status Indicator -->
              <div class="mt-4 pt-4 border-t border-gray-100">
                <div class="flex items-center gap-2">
                  <span
                    class="w-2 h-2 rounded-full <%= table.availabilityStatus === 'Available' ? 'bg-green-500' : table.availabilityStatus === 'Occupied' ? 'bg-blue-500' : 'bg-red-500' %>"
                  ></span>
                  <span class="text-sm text-gray-600"
                    ><%= table.availabilityStatus %></span
                  >
                </div>
              </div>
            </div>
            <% }); %>
          </div>
          <% } %>
        </div>
        <% }); %> <% } %>
      </div>

      <!-- Status Legend -->
      <div
        class="fixed bottom-8 right-8 bg-white px-5 py-4 rounded-lg shadow-xl flex gap-6"
      >
        <div class="flex items-center gap-2 text-sm text-gray-600">
          <span class="w-3 h-3 rounded-full bg-green-600"></span>
          <span>Available</span>
        </div>
        <div class="flex items-center gap-2 text-sm text-gray-600">
          <span class="w-3 h-3 rounded-full bg-blue-600"></span>
          <span>Running</span>
        </div>
        <div class="flex items-center gap-2 text-sm text-gray-600">
          <span class="w-3 h-3 rounded-full bg-red-600"></span>
          <span>Reserved</span>
        </div>
      </div>
    </div>
  </body>
</html>
