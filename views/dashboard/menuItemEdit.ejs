<!-- Update Menu Item Modal - EJS Template -->
<!-- views/dashboard/updateMenuItem.ejs -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Update Menu Item Modal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      .image-preview {
        background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="M21 15l-5-5L5 21"/></svg>');
        background-size: 48px;
        background-position: center;
        background-repeat: no-repeat;
      }

      .modal-overlay {
        background-color: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(4px);
      }

      .modal-content {
        max-height: 90vh;
        overflow-y: auto;
      }

      /* Custom scrollbar for modal */
      .modal-content::-webkit-scrollbar {
        width: 6px;
      }

      .modal-content::-webkit-scrollbar-track {
        background: #f1f1f1;
      }

      .modal-content::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 3px;
      }

      .modal-content::-webkit-scrollbar-thumb:hover {
        background: #555;
      }

      /* Smooth modal animations */
      .modal-overlay {
        animation: fadeIn 0.2s ease-out;
      }

      .modal-content {
        animation: slideUp 0.3s ease-out;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      @keyframes slideUp {
        from {
          transform: translateY(20px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }
    </style>
  </head>
  <body>
    <!-- Modal Overlay -->
    <div id="updateMenuModal" class="fixed inset-0 z-50 hidden modal-overlay">
      <div
        class="flex items-end sm:items-center justify-center min-h-screen p-0 sm:p-4"
      >
        <!-- Modal Content -->
        <div
          class="modal-content bg-white w-full sm:max-w-2xl sm:rounded-2xl rounded-t-2xl shadow-2xl"
        >
          <!-- Modal Header - Sticky -->
          <div
            class="sticky top-0 bg-white border-b border-gray-200 px-4 sm:px-6 py-4 rounded-t-2xl z-10"
          >
            <div class="flex items-center justify-between">
              <div>
                <h2 class="text-xl sm:text-2xl font-bold text-gray-900">
                  Update Menu Item
                </h2>
                <p class="text-xs sm:text-sm text-gray-500 mt-1">
                  Edit the details below
                </p>
              </div>
              <button
                id="closeModalBtn"
                class="p-2 hover:bg-gray-100 rounded-full transition"
              >
                <svg
                  class="w-6 h-6 text-gray-500"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M6 18L18 6M6 6l12 12"
                  />
                </svg>
              </button>
            </div>
          </div>

          <!-- Modal Body - Scrollable -->
          <form
            id="updateMenuItemForm"
            class="p-4 sm:p-6 space-y-6"
            method="POST"
            action="/dashboard/menu-items/edit/<%= menuItem._id %>"
          >
            <!-- Basic Information -->
            <div class="space-y-4">
              <h3
                class="text-base sm:text-lg font-semibold text-gray-900 flex items-center"
              >
                <svg
                  class="w-5 h-5 mr-2 text-orange-500"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                  />
                </svg>
                Basic Information
              </h3>

              <!-- Item Name -->
              <div>
                <label
                  for="itemName"
                  class="block text-sm font-medium text-gray-700 mb-2"
                >
                  Item Name <span class="text-red-500">*</span>
                </label>
                <input
                  type="text"
                  id="itemName"
                  name="itemName"
                  required
                  value="<%= menuItem.itemName %>"
                  placeholder="e.g., Margherita Pizza"
                  class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent transition text-sm sm:text-base"
                />
              </div>

              <!-- Description -->
              <div>
                <label
                  for="description"
                  class="block text-sm font-medium text-gray-700 mb-2"
                >
                  Description
                </label>
                <textarea
                  id="description"
                  name="description"
                  rows="3"
                  placeholder="Describe your dish..."
                  class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent transition resize-none text-sm sm:text-base"
                >
<%= menuItem.description || '' %></textarea
                >
              </div>

              <!-- Category & Type - Responsive Grid -->
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <!-- Category -->
                <div>
                  <select
                    id="category"
                    name="category"
                    required
                    class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent transition appearance-none bg-white text-sm sm:text-base"
                  >
                    <option value="">Select Category</option>
                    <% categories.forEach(cat => { %> <option value="<%= cat._id
                    %>" <%= menuItem.category?.toString() === cat._id.toString()
                    ? 'selected' : '' %>> <%= cat.name %> <% }) %>
                  </select>
                </div>

                <!-- Type -->
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">
                    Type <span class="text-red-500">*</span>
                  </label>
                  <div class="grid grid-cols-3 gap-2">
                    <label class="cursor-pointer">
                      <input type="radio" name="type" value="Veg" required
                      class="sr-only peer" <%= menuItem.type === 'Veg' ?
                      'checked' : '' %> />
                      <div
                        class="px-3 py-2.5 border-2 border-gray-300 rounded-lg peer-checked:border-green-500 peer-checked:bg-green-50 transition flex flex-col items-center justify-center"
                      >
                        <span
                          class="w-3 h-3 rounded-full bg-green-500 mb-1"
                        ></span>
                        <span class="text-xs font-medium text-gray-700"
                          >Veg</span
                        >
                      </div>
                    </label>
                    <label class="cursor-pointer">
                      <input type="radio" name="type" value="Non Veg" required
                      class="sr-only peer" <%= menuItem.type === 'Non Veg' ?
                      'checked' : '' %> />
                      <div
                        class="px-3 py-2.5 border-2 border-gray-300 rounded-lg peer-checked:border-red-500 peer-checked:bg-red-50 transition flex flex-col items-center justify-center"
                      >
                        <span
                          class="w-3 h-3 rounded-full bg-red-500 mb-1"
                        ></span>
                        <span class="text-xs font-medium text-gray-700"
                          >Non Veg</span
                        >
                      </div>
                    </label>
                    <label class="cursor-pointer">
                      <input type="radio" name="type" value="Egg" required
                      class="sr-only peer" <%= menuItem.type === 'Egg' ?
                      'checked' : '' %> />
                      <div
                        class="px-3 py-2.5 border-2 border-gray-300 rounded-lg peer-checked:border-yellow-500 peer-checked:bg-yellow-50 transition flex flex-col items-center justify-center"
                      >
                        <span
                          class="w-3 h-3 rounded-full bg-yellow-500 mb-1"
                        ></span>
                        <span class="text-xs font-medium text-gray-700"
                          >Egg</span
                        >
                      </div>
                    </label>
                  </div>
                </div>
              </div>
            </div>

            <!-- Pricing & Details -->
            <div class="space-y-4 pt-6 border-t border-gray-200">
              <h3
                class="text-base sm:text-lg font-semibold text-gray-900 flex items-center"
              >
                <svg
                  class="w-5 h-5 mr-2 text-orange-500"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                  />
                </svg>
                Pricing & Details
              </h3>

              <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <!-- Price -->
                <div>
                  <label
                    for="price"
                    class="block text-sm font-medium text-gray-700 mb-2"
                  >
                    Price (₹) <span class="text-red-500">*</span>
                  </label>
                  <div class="relative">
                    <span
                      class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-500"
                      >₹</span
                    >
                    <input
                      type="number"
                      id="price"
                      name="price"
                      required
                      min="0"
                      step="0.01"
                      value="<%= menuItem.price %>"
                      placeholder="0.00"
                      class="w-full pl-8 pr-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent transition text-sm sm:text-base"
                    />
                  </div>
                </div>

                <!-- Preparation Time -->
                <div>
                  <label
                    for="preparationTime"
                    class="block text-sm font-medium text-gray-700 mb-2"
                  >
                    Prep Time (mins)
                  </label>
                  <input
                    type="number"
                    id="preparationTime"
                    name="preparationTime"
                    min="0"
                    value="<%= menuItem.preparationTime || '' %>"
                    placeholder="15"
                    class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent transition text-sm sm:text-base"
                  />
                </div>
              </div>

              <!-- Has Variations -->
              <div>
                <label class="flex items-center cursor-pointer">
                  <input type="checkbox" id="hasVariations" name="hasVariations"
                  <%= menuItem.hasVariations ? 'checked' : '' %> class="w-5 h-5
                  text-orange-500 border-gray-300 rounded focus:ring-2
                  focus:ring-orange-500 transition" />
                  <span class="ml-3 text-sm font-medium text-gray-700">
                    Has variations (Small, Medium, Large)
                  </span>
                </label>
              </div>
            </div>

            <!-- Image Upload -->
            <div class="space-y-4 pt-6 border-t border-gray-200">
              <h3
                class="text-base sm:text-lg font-semibold text-gray-900 flex items-center"
              >
                <svg
                  class="w-5 h-5 mr-2 text-orange-500"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"
                  />
                </svg>
                Item Image
              </h3>

              <div class="flex flex-col items-center">
                <div
                  id="imagePreview"
                  class="w-full max-w-[200px] h-40 sm:h-48 border-2 border-dashed border-gray-300 rounded-lg bg-gray-50 overflow-hidden mb-3"
                >
                  <% if (menuItem.menuItemImage && menuItem.menuItemImage.url) {
                  %>
                  <img
                    id="previewImg"
                    src="<%= menuItem.menuItemImage.url %>"
                    class="w-full h-full object-cover"
                    alt="Preview"
                  />
                  <% } else { %>
                  <img
                    id="previewImg"
                    class="w-full h-full object-cover hidden"
                    alt="Preview"
                  />
                  <div class="w-full h-full flex items-center justify-center">
                    <svg
                      class="w-12 h-12 text-gray-400"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"
                      />
                    </svg>
                  </div>
                  <% } %>
                </div>
                <label
                  for="image"
                  class="cursor-pointer inline-flex items-center px-4 py-2 bg-white border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 transition"
                >
                  <svg
                    class="w-4 h-4 mr-2"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"
                    />
                  </svg>
                  Change Image
                </label>
                <input
                  type="file"
                  id="image"
                  name="image"
                  accept="image/*"
                  class="hidden"
                />
                <p class="mt-2 text-xs text-gray-500">PNG, JPG up to 5MB</p>
              </div>
            </div>

            <!-- Hidden Fields -->
            <input type="hidden" name="itemId" value="<%= menuItem._id %>" />
            <input
              type="hidden"
              id="menu"
              name="menu"
              value="<%= menuItem.menu %>"
            />
            <input
              type="hidden"
              id="branch"
              name="branch"
              value="<%= menuItem.branch %>"
            />
          </form>

          <!-- Modal Footer - Sticky -->
          <div
            class="sticky bottom-0 bg-white border-t border-gray-200 px-4 sm:px-6 py-4 rounded-b-2xl"
          >
            <div class="flex flex-col-reverse sm:flex-row gap-3">
              <button
                type="button"
                id="cancelBtn"
                class="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium py-3 px-6 rounded-lg transition-colors flex items-center justify-center"
              >
                <svg
                  class="w-5 h-5 mr-2"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M6 18L18 6M6 6l12 12"
                  />
                </svg>
                Cancel
              </button>
              <button
                type="submit"
                form="updateMenuItemForm"
                class="flex-1 bg-orange-500 hover:bg-orange-600 text-white font-medium py-3 px-6 rounded-lg transition-colors flex items-center justify-center shadow-lg"
              >
                <svg
                  class="w-5 h-5 mr-2"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M5 13l4 4L19 7"
                  />
                </svg>
                Update Item
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      const modal = document.getElementById("updateMenuModal");
      const closeModalBtn = document.getElementById("closeModalBtn");
      const updateMenuItemForm = document.getElementById("updateMenuItemForm");
      const cancelBtn = document.getElementById("cancelBtn");

      // Auto-open modal when page loads
      window.addEventListener("DOMContentLoaded", () => {
        modal.classList.remove("hidden");
        document.body.style.overflow = "hidden";
      });

      // Close Modal
      function closeModal() {
        modal.classList.add("hidden");
        document.body.style.overflow = "";
        window.history.back();
      }

      closeModalBtn.addEventListener("click", closeModal);
      cancelBtn.addEventListener("click", closeModal);

      // Close on backdrop click
      modal.addEventListener("click", (e) => {
        if (e.target === modal) {
          closeModal();
        }
      });

      // Close on ESC key
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape" && !modal.classList.contains("hidden")) {
          closeModal();
        }
      });

      // Image Preview
      document.getElementById("image").addEventListener("change", function (e) {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function (e) {
            const preview = document.getElementById("previewImg");
            const previewContainer = document.getElementById("imagePreview");
            preview.src = e.target.result;
            preview.classList.remove("hidden");
            // Hide placeholder if exists
            const placeholder = previewContainer.querySelector("div");
            if (placeholder) placeholder.style.display = "none";
          };
          reader.readAsDataURL(file);
        }
      });
    </script>
  </body>
</html>
