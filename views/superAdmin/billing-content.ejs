<div class="space-y-6" style="--tc:<%= themeColor %>;">
  <% if (showRestaurantDetails && restaurant) { %>

    <!-- BACK BUTTON -->
    <a href="/admin-dashboard/billing" class="inline-flex items-center mb-4 transition-colors"
      style="color: var(--tc);">
      <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
      </svg>
      <span class="font-medium">Back to Billing</span>
    </a>

    <!-- Restaurant Details -->
    <%- include('restaurantDetails', { restaurant, branches, purchases, currentPackage, currentPurchase, trialExpiresOn,
      totalOrders }) %>

      <% } else { %>

        <%- include("../includes/flash.ejs") %>

          <!-- SEARCH BAR -->
          <div class="bg-white rounded-lg shadow-sm p-4">
            <input type="text" id="searchInput" placeholder="Search payments by restaurant, amount, transaction ID..."
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2"
              style="--tw-ring-color: var(--tc);">
          </div>

          <!-- PAYMENTS TABLE -->
          <div class="bg-white rounded-lg shadow-sm overflow-hidden">
            <div class="overflow-x-auto">
              <table class="w-full" id="paymentsTable">

                <thead class="bg-gray-50 border-b border-gray-200">
                  <tr>
                    <% [ "ID" , "Restaurant Name" , "Package Details" , "Billing Cycle" , "Payment Date"
                      , "Next Payment Date" , "Transaction ID" , "Payment Gateway" , "Amount" , "Action" ].forEach(h=> {
                      %>

                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        <%= h %>
                      </th>

                      <% }) %>
                  </tr>
                </thead>

                <tbody class="bg-white divide-y divide-gray-200">
                  <% if (payments && payments.length> 0) { %>

                    <% payments.forEach(payment=> { %>
                      <tr class="transition-colors" style="transition: background 0.2s; cursor: pointer;"
                        onmouseover="this.style.background='color-mix(in srgb, var(--tc) 10%, white)'"
                        onmouseout="this.style.background='white'">

                        <!-- ID -->
                        <td class="px-6 py-4 text-sm text-gray-900">
                          <%= payment.id %>
                        </td>

                        <!-- Restaurant Link -->
                        <td class="px-6 py-4 whitespace-nowrap">
                          <a href="/admin-dashboard/restaurant/<%= payment.userId %>"
                            class="text-sm font-medium underline transition" style="color: var(--tc);">
                            <%= payment.restaurant %>
                          </a>
                        </td>

                        <!-- PACKAGE DETAILS -->
                        <td class="px-6 py-4 whitespace-nowrap">
                          <div class="flex items-center gap-2">
                            <span class="text-sm text-gray-900">
                              <%= payment.package %>
                            </span>

                            <% if (payment.isTrial) { %>
                              <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium"
                                style="background: color-mix(in srgb, var(--tc) 25%, white); color: var(--tc);">
                                <i class="fa-solid fa-clock text-[10px] mr-1"></i> Trial
                              </span>

                              <% } else if (payment.isLifetime) { %>
                                <span
                                  class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800">
                                  <i class="fa-solid fa-infinity text-[10px] mr-1"></i> Lifetime
                                </span>
                                <% } %>
                          </div>
                        </td>

                        <!-- BILLING CYCLE -->
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                          <%= payment.cycle %>
                        </td>

                        <!-- PAYMENT DATE -->
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                          <%= payment.paymentDate %>
                        </td>

                        <!-- NEXT PAYMENT -->
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                          <%= payment.nextPayment %>
                        </td>

                        <!-- TRANSACTION ID -->
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-mono text-gray-600">
                          <%= payment.transactionId %>
                        </td>

                        <!-- GATEWAY BADGE -->
                        <td class="px-6 py-4 whitespace-nowrap">
                          <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium capitalize
                      <%= payment.gateway === 'razorpay' ? 'bg-blue-100 text-blue-800' :
                          payment.gateway === 'stripe' ? 'bg-indigo-100 text-indigo-800' :
                          payment.gateway === 'paypal' ? 'bg-sky-100 text-sky-800' :
                          'bg-gray-100 text-gray-800' %>">
                            <%= payment.gateway %>
                          </span>
                        </td>

                        <!-- AMOUNT -->
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-900">
                          <%= payment.amount %>
                        </td>

                        <!-- ACTION BUTTON -->
                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                          <button onclick="downloadInvoice('<%= payment.transactionId %>')"
                            class="p-2 rounded-lg transition-colors"
                            style="color: var(--tc); background: color-mix(in srgb, var(--tc) 12%, transparent);"
                            title="Download Invoice">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                            </svg>
                          </button>
                        </td>

                      </tr>
                      <% }) %>

                        <% } else { %>

                          <!-- NO DATA ROW -->
                          <tr>
                            <td colspan="10" class="px-6 py-12 text-center">
                              <div class="flex flex-col items-center text-gray-500">
                                <i class="fa-solid fa-file-invoice text-5xl mb-3 text-gray-300"></i>
                                <p class="text-lg font-medium">No payments found</p>
                                <p class="text-sm mt-1">When restaurants subscribe, payments will appear here.</p>
                              </div>
                            </td>
                          </tr>

                          <% } %>
                </tbody>

              </table>
            </div>
          </div>

          <!-- SEARCH SCRIPT -->
          <script>
            document.getElementById('searchInput').addEventListener('input', e => {
              const search = e.target.value.toLowerCase();
              document.querySelectorAll('#paymentsTable tbody tr').forEach(row => {
                row.style.display = row.textContent.toLowerCase().includes(search) ? '' : 'none';
              });
            });

            function downloadInvoice(id) {
              if (id === '-') {
                alert("No invoice available.");
                return;
              }
              console.log("Downloading invoice:", id);
            }
          </script>

          <% } %>
</div>