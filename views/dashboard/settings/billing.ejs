<!-- Billing Section -->
<div class="bg-white rounded-lg shadow-sm hidden settings-content" id="billing">
  <div class="border-b border-gray-200">
    <nav class="flex space-x-8 px-6" aria-label="Tabs">
      <button onclick="switchTab('planDetails')" id="tab-planDetails"
        class="tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-orange-500 text-orange-600">
        Plan Details
      </button>
      <button onclick="switchTab('purchaseHistory')" id="tab-purchaseHistory"
        class="tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">
        Purchase History
      </button>
      <button onclick="switchTab('offlineRequest')" id="tab-offlineRequest"
        class="tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">
        Offline Request
      </button>
    </nav>
  </div>

  <!-- Tab Content -->
  <div class="p-6">
    <!-- Plan Details Tab -->
    <div id="content-planDetails" class="tab-content">
      <div class="flex items-center mb-6">
        <i class="fas fa-gift text-orange-500 text-2xl mr-3"></i>
        <h2 class="text-xl font-semibold text-gray-800">Plan Details</h2>
      </div>

      <% if (currentPackage) { %>
        <div class="space-y-6">
          <!-- Branch Info -->
          <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm text-blue-600 font-medium">Subscription for</p>
                <p class="text-lg font-semibold text-blue-900">
                  <%= branch.branchName %>
                </p>
              </div>
              <% if (currentSubscription.isExpired) { %>
                <span
                  class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800">
                  <i class="fas fa-exclamation-triangle mr-1"></i> Expired
                </span>
                <% } else if (currentSubscription.status==='trial' ) { %>
                  <span
                    class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                    <i class="fas fa-clock mr-1"></i> Trial (<%= currentSubscription.daysRemaining %> days left)
                  </span>
                  <% } else { %>
                    <span
                      class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                      <i class="fas fa-check-circle mr-1"></i> Active
                    </span>
                    <% } %>
            </div>
          </div>

          <div>
            <p class="text-sm text-gray-600 mb-2">Current Plan Name</p>
            <p class="text-2xl font-semibold text-orange-600">
              <%= currentPackage.name %>
            </p>
          </div>

          <div>
            <p class="text-sm text-gray-600 mb-2">Current Plan Type</p>
            <div class="flex items-center gap-2">
              <p class="text-2xl font-semibold text-orange-600">
                <%= currentPackage.isTrial ? 'Trial' : 'Paid' %> (<%= currentSubscription.status.charAt(0).toUpperCase()
                    + currentSubscription.status.slice(1) %>)
              </p>
              <% if (currentPackage.isRecommended) { %>
                <span
                  class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                  <i class="fas fa-star mr-1"></i> Recommended
                </span>
                <% } %>
            </div>
          </div>

          <!-- Subscription Dates -->
          <div class="grid grid-cols-2 gap-4">
            <div class="bg-gray-50 rounded-lg p-4">
              <p class="text-xs text-gray-500 mb-1">Start Date</p>
              <p class="text-sm font-semibold text-gray-900">
                <%= new Date(currentSubscription.packageStartDate).toLocaleDateString('en-GB', { day: '2-digit' ,
                  month: 'short' , year: 'numeric' }) %>
              </p>
            </div>
            <% if (currentSubscription.packageExpiryDate) { %>
              <div class="bg-gray-50 rounded-lg p-4">
                <p class="text-xs text-gray-500 mb-1">Expiry Date</p>
                <p
                  class="text-sm font-semibold <%= currentSubscription.isExpired ? 'text-red-600' : 'text-gray-900' %>">
                  <%= new Date(currentSubscription.packageExpiryDate).toLocaleDateString('en-GB', { day: '2-digit' ,
                    month: 'short' , year: 'numeric' }) %>
                </p>
              </div>
              <% } %>
          </div>

          <% if (currentPackage.isTrial && currentPackage.trialDays> 0 && !currentSubscription.isExpired) { %>
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
              <div class="flex items-center justify-between">
                <div class="flex items-center">
                  <i class="fas fa-info-circle text-blue-500 mr-2"></i>
                  <span class="text-sm text-blue-800">
                    Trial period: <strong>
                      <%= currentPackage.trialDays %> days
                    </strong>
                  </span>
                </div>
                <span class="text-sm font-semibold text-blue-900">
                  <%= currentSubscription.daysRemaining %> days remaining
                </span>
              </div>
            </div>
            <% } %>

              <% if (currentSubscription.isExpired) { %>
                <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                  <div class="flex items-center">
                    <i class="fas fa-exclamation-triangle text-red-500 mr-2"></i>
                    <span class="text-sm text-red-800">
                      Your subscription has expired. Please upgrade to continue using all features.
                    </span>
                  </div>
                </div>
                <% } %>

                  <div class="bg-gray-50 rounded-lg p-4">
                    <p class="text-sm font-medium text-gray-700 mb-3">Plan Pricing:</p>
                    <div class="grid grid-cols-3 gap-4">
                      <div class="text-center">
                        <p class="text-xs text-gray-500 mb-1">Monthly</p>
                        <p class="text-lg font-semibold text-gray-900">
                          <%= currentPackage.monthlyPrice ? '₹' + currentPackage.monthlyPrice : 'N/A' %>
                        </p>
                      </div>
                      <div class="text-center">
                        <p class="text-xs text-gray-500 mb-1">Annual</p>
                        <p class="text-lg font-semibold text-gray-900">
                          <%= currentPackage.annualPrice ? '₹' + currentPackage.annualPrice : 'N/A' %>
                        </p>
                      </div>
                      <div class="text-center">
                        <p class="text-xs text-gray-500 mb-1">Lifetime</p>
                        <p class="text-lg font-semibold text-gray-900">
                          <%= currentPackage.lifetimePrice ? '₹' + currentPackage.lifetimePrice : 'N/A' %>
                        </p>
                      </div>
                    </div>
                  </div>

                  <% if (currentPackage.modules && currentPackage.modules.length> 0) { %>
                    <div>
                      <p class="text-sm font-medium text-gray-700 mb-3">
                        Included Modules:
                      </p>
                      <div class="flex flex-wrap gap-2">
                        <% currentPackage.modules.forEach(function(module) { %>
                          <span
                            class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-orange-100 text-orange-800 capitalize">
                            <i class="fas fa-check-circle mr-1.5"></i>
                            <%= module %>
                          </span>
                          <% }); %>
                      </div>
                    </div>
                    <% } %>

                      <% if (currentPackage.additionalFeatures && currentPackage.additionalFeatures.length> 0) { %>
                        <div>
                          <p class="text-sm font-medium text-gray-700 mb-3">
                            Additional Features:
                          </p>
                          <ul class="list-disc list-inside space-y-1">
                            <% currentPackage.additionalFeatures.forEach(function(feature) { %>
                              <li class="text-sm text-gray-600">
                                <%= feature %>
                              </li>
                              <% }); %>
                          </ul>
                        </div>
                        <% } %>

                          <button onclick="window.location.href='/upgrade-plan/<%= branchId %>'"
                            class="mt-4 bg-orange-500 hover:bg-orange-600 text-white font-medium py-3 px-6 rounded-lg flex items-center transition duration-200">
                            <i class="fas fa-sparkles mr-2"></i>
                            <%= currentSubscription.isExpired ? 'Renew Plan' : 'Upgrade Plan' %>
                          </button>
        </div>
        <% } else { %>
          <div class="text-center py-12">
            <i class="fas fa-inbox text-gray-300 text-5xl mb-4"></i>
            <p class="text-gray-500 text-lg">No active plan found.</p>
            <button onclick="window.location.href='/packages/<%= branchId %>'"
              class="mt-4 bg-orange-500 hover:bg-orange-600 text-white font-medium py-3 px-6 rounded-lg transition duration-200">
              Browse Plans
            </button>
          </div>
          <% } %>
    </div>

    <!-- Purchase History Tab -->
    <div id="content-purchaseHistory" class="tab-content hidden">
      <div class="flex items-center mb-6">
        <i class="fas fa-history text-orange-500 text-2xl mr-3"></i>
        <h2 class="text-xl font-semibold text-gray-800">Purchase History</h2>
      </div>

      <% if (purchaseHistory && purchaseHistory.length> 0) { %>
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
              <tr>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Package
                </th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Billing Cycle
                </th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Payment Date
                </th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Next Payment Date
                </th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Transaction ID
                </th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Payment Gateway
                </th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Amount
                </th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Action
                </th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
              <% purchaseHistory.forEach(function(purchase) { %>
                <tr class="hover:bg-gray-50">
                  <td class="px-6 py-4 whitespace-nowrap">
                    <div class="flex flex-col">
                      <span class="text-sm font-medium text-gray-900">
                        <%= purchase.packageName %>
                      </span>
                      <span
                        class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium <%= purchase.status === 'completed' ? 'bg-green-100 text-green-800' : purchase.status === 'pending' ? 'bg-yellow-100 text-yellow-800' : purchase.status === 'failed' ? 'bg-red-100 text-red-800' : 'bg-gray-100 text-gray-800' %> w-fit mt-1">
                        <i class="fas fa-circle mr-1" style="font-size: 6px"></i>
                        <%= purchase.status.charAt(0).toUpperCase() + purchase.status.slice(1) %>
                      </span>
                    </div>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 capitalize">
                    <%= purchase.billingCycle %>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                    <%= new Date(purchase.paymentDate).toLocaleDateString('en-GB', { day: '2-digit' , month: 'short' ,
                      year: 'numeric' }) %>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                    <%= purchase.nextPaymentDate ? new Date(purchase.nextPaymentDate).toLocaleDateString('en-GB', {
                      day: '2-digit' , month: 'short' , year: 'numeric' }) : '-' %>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-mono">
                    <%= purchase.transactionId || '-' %>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 capitalize">
                    <%= purchase.paymentGateway %>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-900">
                    <%= purchase.amount> 0 ? '₹' + purchase.amount : '-' %>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm">
                    <% if (purchase.invoiceUrl) { %>

                      href="<%= purchase.invoiceUrl %>"
                        target="_blank"
                        class="text-orange-600 hover:text-orange-900"
                        title="Download Invoice"
                        >
                        <i class="fas fa-download"></i>
                        </a>
                        <% } else { %>
                          <span class="text-gray-300">
                            <i class="fas fa-download"></i>
                          </span>
                          <% } %>
                  </td>
                </tr>
                <% }); %>
            </tbody>
          </table>
        </div>
        <% } else { %>
          <div class="text-center py-12">
            <i class="fas fa-inbox text-gray-300 text-5xl mb-4"></i>
            <p class="text-gray-500 text-lg">No purchase history found.</p>
          </div>
          <% } %>
    </div>

    <!-- Offline Request Tab -->
    <div id="content-offlineRequest" class="tab-content hidden">
      <div class="flex items-center justify-between mb-6">
        <div class="flex items-center">
          <i class="fas fa-clock text-orange-500 text-2xl mr-3"></i>
          <h2 class="text-xl font-semibold text-gray-800">Offline Request</h2>
        </div>
        <button onclick="window.location.href='/offline-payment-request/<%= branchId %>'"
          class="bg-orange-500 hover:bg-orange-600 text-white font-medium py-2 px-4 rounded-lg transition duration-200 text-sm">
          <i class="fas fa-plus mr-2"></i>
          New Request
        </button>
      </div>

      <% if (offlineRequests && offlineRequests.length> 0) { %>
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
              <tr>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Package Details
                </th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Billing Cycle
                </th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Amount
                </th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Payment By
                </th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Created
                </th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Status
                </th>
                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Action
                </th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
              <% offlineRequests.forEach(function(request) { %>
                <tr class="hover:bg-gray-50">
                  <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                    <%= request.packageName %>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 capitalize">
                    <%= request.billingCycle %>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-900">
                    ₹<%= request.amount %>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 capitalize">
                    <%= request.paymentMethod %>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                    <%= new Date(request.createdAt).toLocaleDateString('en-GB', { day: '2-digit' , month: 'short' ,
                      year: 'numeric' }) %>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap">
                    <span
                      class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium <%= request.status === 'pending' ? 'bg-yellow-100 text-yellow-800' : request.status === 'approved' ? 'bg-green-100 text-green-800' : request.status === 'rejected' ? 'bg-red-100 text-red-800' : 'bg-gray-100 text-gray-800' %>">
                      <%= request.status.charAt(0).toUpperCase() + request.status.slice(1) %>
                    </span>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm">
                    <button onclick="viewOfflineRequest('<%= request._id %>')"
                      class="text-blue-600 hover:text-blue-900 mr-3" title="View Details">
                      <i class="fas fa-eye"></i>
                    </button>
                    <% if (request.status==='pending' ) { %>
                      <button onclick="deleteOfflineRequest('<%= request._id %>', '<%= branchId %>')"
                        class="text-red-600 hover:text-red-900" title="Delete Request">
                        <i class="fas fa-trash"></i>
                      </button>
                      <% } %>
                  </td>
                </tr>
                <% }); %>
            </tbody>
          </table>
        </div>
        <% } else { %>
          <div class="text-center py-12">
            <i class="fas fa-inbox text-gray-300 text-5xl mb-4"></i>
            <p class="text-gray-500 text-lg mb-4">
              No offline payment request found.
            </p>
            <button onclick="window.location.href='/offline-payment-request/<%= branchId %>'"
              class="bg-orange-500 hover:bg-orange-600 text-white font-medium py-2 px-4 rounded-lg transition duration-200">
              Create Request
            </button>
          </div>
          <% } %>
    </div>
  </div>
</div>